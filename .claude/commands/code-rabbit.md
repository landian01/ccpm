---
allowed-tools: Task, Read, Edit, MultiEdit, Write, LS, Grep
---

# CodeRabbit 审核处理器

以具有上下文感知的审慎态度处理 CodeRabbit 审核评论。

## 用法
```
/code-rabbit
```

然后粘贴一个或多个 CodeRabbit 评论。

## 指令

### 1. 初始上下文

告知用户：
```
我将以审慎的态度审查 CodeRabbit 评论，因为 CodeRabbit 无法访问整个代码库，可能无法理解完整的上下文。

对于每个评论，我将：
- 根据我们的代码库上下文评估其有效性
- 接受能提高代码质量的建议
- 忽略不适用于我们架构的建议
- 解释我接受/忽略决策的理由
```

### 2. 处理评论

#### 单文件评论
如果所有评论都涉及一个文件：
- 读取文件以了解上下文
- 评估每个建议
- 使用 MultiEdit 批量应用接受的更改
- 报告哪些建议被接受/忽略以及原因

#### 多文件评论
如果评论涉及多个文件：

使用 Task 工具启动并行子代理：
```yaml
Task:
  description: "CodeRabbit 修复 - {filename}"
  subagent_type: "general-purpose"
  prompt: |
    审查并应用 {filename} 的 CodeRabbit 建议。
    
    要评估的评论：
    {relevant_comments_for_this_file}
    
    指令：
    1. 读取文件以了解上下文
    2. 对于每个建议：
       - 根据代码库模式评估其有效性
       - 如果能提高质量/正确性则接受
       - 如果不适用则忽略
    3. 使用 Edit/MultiEdit 应用接受的更改
    4. 返回摘要：
       - 已接受：{附带理由的列表}
       - 已忽略：{附带理由的列表}
       - 已进行的更改：{简要描述}
    
    使用审慎态度 - CodeRabbit 缺乏完整的上下文。
```

### 3. 整合结果

所有子代理完成后：
```
📋 CodeRabbit 审核摘要

已处理文件：{count}

已接受建议：
  {file}：{已进行的更改}
  
已忽略建议：
  {file}：{忽略原因}

总计：{X}/{Y} 个建议已应用
```

### 4. 常见忽略模式

- 与项目约定冲突的**风格偏好**
- 不适用于我们特定用例的**通用最佳实践**
- 对非性能关键代码的**性能优化**
- 内部工具的**可访问性建议**
- 已验证模式的**安全警告**
- 会破坏我们结构的**导入重组**

### 5. 常见接受模式

- **实际错误**（空值检查、错误处理）
- **安全漏洞**（除非是误报）
- **资源泄漏**（未关闭的连接、内存泄漏）
- **类型安全问题**（TypeScript/类型提示）
- **逻辑错误**（差一错误、错误条件）
- **缺失的错误处理** 

## 决策框架

对于每个建议，请考虑：
1. **它是否正确？** - 这个问题是否真的存在？
2. **它是否相关？** - 它是否适用于我们的用例？
3. **它是否有益？** - 修复它会改善代码吗？
4. **它是否安全？** - 这个更改会引入问题吗？

只有当所有答案都是"是"，或者收益明显大于风险时才应用。

## 重要说明

- CodeRabbit 很有帮助但缺乏上下文
- 相信你对代码库的理解而不是通用建议
- 简要解释决策以保持审计跟踪
- 批量处理相关更改以提高效率
- 使用并行代理进行多文件审查以节省时间