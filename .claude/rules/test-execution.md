# 测试执行规则

所有测试命令中运行测试的标准模式。

## 核心原则

1. **始终使用 test-runner 代理** 来自 `.claude/agents/test-runner.md`
2. **不要模拟** - 使用真实服务获得准确结果
3. **详细输出** - 捕获所有内容用于调试
4. **首先检查测试结构** - 在假设代码错误之前

## 执行模式

```markdown
执行测试：{target}

要求：
- 以详细输出运行
- 不要模拟服务
- 捕获完整的堆栈跟踪
- 如果发生失败，分析测试结构
```

## 输出重点

### 成功
保持简单：
```
✅ 所有测试通过（{count} 个测试，用时 {time} 秒）
```

### 失败
专注于失败的内容：
```
❌ 测试失败：{count}

{test_name} - {file}:{line}
  错误：{message}
  修复：{suggestion}
```

## 常见问题

- 测试未找到 → 检查文件路径
- 超时 → 终止进程，报告未完成
- 框架缺失 → 安装依赖项

## 清理

测试后始终清理：
```bash
pkill -f "jest|mocha|pytest" 2>/dev/null || true
```

## 重要说明

- 不要并行化测试（避免冲突）
- 让每个测试完全完成
- 报告失败并提供可操作的修复
- 输出重点放在失败上，而不是成功上